<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Game Over Tracker</title>
    
    <!-- Modern PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">

    <!-- Tailwind CSS (Development CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 1. Load React First -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- 2. Load Prop-Types (Required by Recharts) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- 3. Load Recharts -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- 4. Load Babel Last -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; }
        .chart-container .recharts-cartesian-grid-horizontal line, 
        .chart-container .recharts-cartesian-grid-vertical line {
            stroke: #f1f5f9;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } = Recharts;
        
        const Icons = {
            Dumbbell: () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6.5 6.5 11 11"/><path d="m10 10 5.5 5.5"/><path d="m3 7 4 4"/><path d="m9 3 4 4"/><path d="m17 13 4 4"/><path d="m13 17 4 4"/></svg>
            ),
            Save: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
            ),
            Calendar: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
            ),
            BarChart3: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
            ),
            Trash: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
            ),
            Chevron: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            )
        };

        const APP_ID = 'game-over-tracker-v5';

        const programData = {
            1: { title: "Conditioning", targetReps: "12-15", workouts: {
                "Monday": [{ name: "Incline Barbell Press", sets: 4 }, { name: "Flat Barbell Press", sets: 4 }, { name: "Dumbbell Flyes", sets: 4 }, { name: "Push Ups", sets: 3 }, { name: "Crunches", sets: 4 }, { name: "Reverse Crunches", sets: 4 }],
                "Tuesday": [{ name: "Squats", sets: 4 }, { name: "Stiff Leg Deadlift", sets: 4 }, { name: "Leg Curl", sets: 4 }, { name: "Leg Press", sets: 4 }, { name: "Leg Extension", sets: 4 }, { name: "Standing Calf Raise", sets: 4 }, { name: "Seated Calf Raise", sets: 4 }],
                "Wednesday": [{ name: "Bent Over Barbell Row", sets: 4 }, { name: "1-Arm Dumbbell Row", sets: 4 }, { name: "Cable Pull Downs", sets: 4 }, { name: "Wide Grip Pull Downs", sets: 4 }, { name: "Dumbbell Shrugs", sets: 4 }, { name: "Hyperextensions", sets: 4 }],
                "Friday": [{ name: "Standing Barbell Curls", sets: 4 }, { name: "Preacher Curls", sets: 4 }, { name: "Hammer Curls", sets: 3 }, { name: "Triceps Press Down", sets: 4 }, { name: "Over Head Extensions", sets: 4 }, { name: "Weighted Dips", sets: 3 }, { name: "V-ups", sets: 4 }, { name: "Leg Raises", sets: 4 }],
                "Saturday": [{ name: "Dumbbell Military Press", sets: 4 }, { name: "Front DB Raise", sets: 4 }, { name: "Side Lateral Raise", sets: 4 }, { name: "Rear Delt Machine", sets: 4 }, { name: "Standing Calf Raise", sets: 4 }, { name: "Seated Calf Raise", sets: 4 }]
            }},
            2: { title: "Growth", targetReps: "6-10", workouts: {
                "Monday": [{ name: "Incline Barbell Press", sets: 6 }, { name: "Flat Barbell Press", sets: 6 }, { name: "Pec Deck", sets: 4 }, { name: "Push Ups", sets: 3 }, { name: "V-ups", sets: 4 }, { name: "Leg Raises", sets: 4 }],
                "Tuesday": [{ name: "Squats", sets: 6 }, { name: "Stiff Leg Deadlift", sets: 6 }, { name: "Leg Curl", sets: 4 }, { name: "Leg Press", sets: 6 }, { name: "Leg Extension", sets: 4 }, { name: "Standing Calf Raise", sets: 4 }, { name: "Seated Calf Raise", sets: 4 }],
                "Wednesday": [{ name: "High Row Wide Grip", sets: 6 }, { name: "Close Grip Low Row", sets: 6 }, { name: "Wide Grip Pull Downs", sets: 6 }, { name: "Dumbbell Pullovers", sets: 4 }, { name: "Barbell Shrugs", sets: 6 }, { name: "Hyperextensions", sets: 4 }],
                "Friday": [{ name: "Dumbbell Curls", sets: 6 }, { name: "Preacher Curls", sets: 6 }, { name: "Concentration Curls", sets: 3 }, { name: "Close Grip Press", sets: 6 }, { name: "V-Bar Press Down", sets: 6 }, { name: "Single Arm Over Head Ext", sets: 3 }],
                "Saturday": [{ name: "Dumbbell Military Press", sets: 6 }, { name: "Front DB Raise", sets: 6 }, { name: "Side Lateral Raise", sets: 6 }, { name: "Rear Delt Machine", sets: 6 }, { name: "Standing Calf Raise", sets: 4 }, { name: "Seated Calf Raise", sets: 4 }]
            }},
            3: { title: "Strength", targetReps: "4-6", workouts: {
                "Monday": [{ name: "Incline Barbell Press", sets: 6 }, { name: "Flat Barbell Press", sets: 6 }, { name: "Dumbbell Flyes", sets: 4 }, { name: "Push Ups", sets: 3 }, { name: "Crunches", sets: 4 }, { name: "Reverse Crunches", sets: 4 }],
                "Tuesday": [{ name: "Squats", sets: 6 }, { name: "Stiff Leg Deadlift", sets: 6 }, { name: "Leg Curl", sets: 4 }, { name: "Leg Press", sets: 6 }, { name: "Leg Extension", sets: 4 }, { name: "Standing Calf Raise", sets: 4 }, { name: "Seated Calf Raise", sets: 4 }],
                "Wednesday": [{ name: "Barbell Rows", sets: 6 }, { name: "One Arm Dumbbell Rows", sets: 6 }, { name: "Cable Pull Downs", sets: 4 }, { name: "Wide Grip Pull Downs", sets: 6 }, { name: "Dumbbell Shrugs", sets: 6 }, { name: "Hyperextensions", sets: 4 }],
                "Friday": [{ name: "Barbell Curls", sets: 6 }, { name: "Preacher Curls", sets: 6 }, { name: "Hammer Curls", sets: 3 }, { name: "Triceps Press Down", sets: 6 }, { name: "Overhead Extension", sets: 6 }, { name: "Weighted Dips", sets: 3 }, { name: "V-Ups", sets: 4 }, { name: "Leg Raises", sets: 4 }],
                "Saturday": [{ name: "Overhead Press", sets: 6 }, { name: "DB Front Raise", sets: 6 }, { name: "Side Lateral Raise", sets: 5 }, { name: "Rear Delt Fly", sets: 6 }, { name: "Standing Calf Raise", sets: 4 }, { name: "Seated Calf Raise", sets: 4 }]
            }}
        };

        function App() {
            const [view, setView] = useState('workout');
            const [phase, setPhase] = useState(1);
            const [day, setDay] = useState('Monday');
            const [selectedStatEx, setSelectedStatEx] = useState('');
            const [logs, setLogs] = useState({});
            const [history, setHistory] = useState([]);
            const [toast, setToast] = useState(null);

            useEffect(() => {
                const savedLogs = localStorage.getItem(`${APP_ID}_logs`);
                const savedHistory = localStorage.getItem(`${APP_ID}_history`);
                if (savedLogs) setLogs(JSON.parse(savedLogs));
                if (savedHistory) setHistory(JSON.parse(savedHistory));
                setSelectedStatEx(programData[1].workouts['Monday'][0].name);
            }, []);

            const saveSession = () => {
                const timestamp = new Date().toISOString();
                const sessionEntries = Object.entries(logs).map(([key, data]) => ({
                    ...data,
                    key,
                    date: timestamp.split('T')[0]
                })).filter(entry => entry.w && entry.r);

                const newHistory = [...history, ...sessionEntries];
                setHistory(newHistory);
                localStorage.setItem(`${APP_ID}_history`, JSON.stringify(newHistory));
                setToast("PROGRESS SAVED");
                setTimeout(() => setToast(null), 2000);
            };

            const clearData = () => {
                if (confirm("Permanently delete all workout history?")) {
                    setLogs({}); setHistory([]);
                    localStorage.clear();
                }
            };

            const analyticsData = useMemo(() => {
                if (!selectedStatEx) return [];
                const filtered = history.filter(h => h.key.includes(selectedStatEx));
                const byDate = filtered.reduce((acc, curr) => {
                    if (!acc[curr.date]) acc[curr.date] = [];
                    acc[curr.date].push(parseFloat(curr.w));
                    return acc;
                }, {});
                return Object.entries(byDate).map(([date, weights]) => ({
                    date: date.slice(5),
                    peak: Math.max(...weights),
                    average: Math.round((weights.reduce((a, b) => a + b, 0) / weights.length) * 10) / 10
                })).sort((a, b) => new Date(a.date) - new Date(b.date));
            }, [history, selectedStatEx]);

            return (
                <div className="min-h-screen pb-24 font-sans max-w-md mx-auto relative">
                    {toast && <div className="fixed top-8 left-1/2 -translate-x-1/2 bg-red-600 text-white px-6 py-3 rounded-full font-bold shadow-2xl z-50">{toast}</div>}
                    
                    <header className="bg-slate-900 text-white p-6 pt-10 flex justify-between items-end">
                        <div>
                            <h1 className="text-3xl font-black italic uppercase tracking-tighter">Game Over</h1>
                            <p className="text-[10px] text-red-500 font-bold uppercase mt-2 tracking-widest">Strength Tracker v5</p>
                        </div>
                        <button onClick={clearData} className="text-slate-500 hover:text-red-500 p-2"><Icons.Trash /></button>
                    </header>
                    
                    <nav className="flex bg-white sticky top-0 z-20 shadow-sm">
                        {[1, 2, 3].map(p => (
                            <button key={p} onClick={() => setPhase(p)} className={`flex-1 py-4 text-xs font-black uppercase border-b-4 ${phase === p ? 'border-red-600 text-red-600' : 'border-transparent text-slate-400'}`}>Phase {p}</button>
                        ))}
                    </nav>

                    {view === 'workout' ? (
                        <div className="p-4 space-y-4">
                            <div className="relative">
                                <select value={day} onChange={(e) => {setDay(e.target.value); setSelectedStatEx(programData[phase].workouts[e.target.value][0].name)}} className="w-full p-4 bg-white rounded-2xl border-none shadow-sm text-lg font-bold appearance-none">
                                    {Object.keys(programData[phase].workouts).map(d => <option key={d} value={d}>{d}</option>)}
                                </select>
                                <div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400"><Icons.Chevron /></div>
                            </div>

                            {programData[phase].workouts[day].map((ex) => (
                                <div key={ex.name} className="bg-white p-5 rounded-3xl shadow-sm border border-slate-100">
                                    <div className="flex justify-between items-start mb-4">
                                        <h3 className="text-sm font-black text-slate-800 uppercase flex items-center gap-2 text-wrap pr-2">
                                            <Icons.Dumbbell /> {ex.name}
                                        </h3>
                                        <span className="text-[10px] font-black px-2 py-1 bg-slate-100 rounded text-slate-500 uppercase shrink-0">{ex.sets} Sets</span>
                                    </div>
                                    <div className="space-y-3">
                                        {[...Array(ex.sets)].map((_, i) => {
                                            const s = i + 1;
                                            const logKey = `${phase}-${day}-${ex.name}-s${s}`;
                                            const data = logs[logKey] || { w: '', r: '' };
                                            return (
                                                <div key={s} className="flex gap-3">
                                                    <div className="w-8 h-8 flex items-center justify-center bg-slate-900 rounded-lg text-[10px] font-black text-white shrink-0">S{s}</div>
                                                    <input type="number" inputMode="decimal" placeholder="Lbs" value={data.w} onChange={(e) => setLogs({...logs, [logKey]: {...data, w: e.target.value}})} className="flex-1 p-3 bg-slate-50 rounded-xl text-center font-bold outline-none focus:ring-2 focus:ring-red-500" />
                                                    <input type="number" inputMode="numeric" placeholder="Reps" value={data.r} onChange={(e) => setLogs({...logs, [logKey]: {...data, r: e.target.value}})} className="w-16 p-3 bg-slate-50 rounded-xl text-center font-black outline-none focus:ring-2 focus:ring-red-500" />
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="p-4 space-y-4">
                            <div className="bg-white p-4 rounded-3xl shadow-sm">
                                <p className="text-[10px] font-black text-slate-400 uppercase mb-2">Selected Exercise</p>
                                <select value={selectedStatEx} onChange={(e) => setSelectedStatEx(e.target.value)} className="w-full bg-slate-50 p-3 rounded-xl font-bold outline-none">
                                    {programData[phase].workouts[day].map(ex => <option key={ex.name} value={ex.name}>{ex.name}</option>)}
                                </select>
                            </div>
                            <div className="bg-white p-6 rounded-3xl shadow-sm h-80 chart-container">
                                {analyticsData.length > 0 ? (
                                    <ResponsiveContainer width="100%" height="100%">
                                        <LineChart data={analyticsData}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                            <XAxis dataKey="date" fontSize={10} tickLine={false} axisLine={false} />
                                            <YAxis fontSize={10} tickLine={false} axisLine={false} />
                                            <Tooltip contentStyle={{borderRadius: '16px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'}} />
                                            <Legend verticalAlign="top" height={36} wrapperStyle={{fontSize: '10px', fontWeight: 'bold'}} />
                                            <Line type="monotone" name="Peak Weight" dataKey="peak" stroke="#ef4444" strokeWidth={4} dot={{r: 4, fill: '#ef4444'}} />
                                            <Line type="monotone" name="Average" dataKey="average" stroke="#3b82f6" strokeWidth={2} strokeDasharray="5 5" />
                                        </LineChart>
                                    </ResponsiveContainer>
                                ) : (
                                    <div className="flex items-center justify-center h-full text-center text-slate-400 font-bold uppercase text-xs">No logs found for this move.</div>
                                )}
                            </div>
                        </div>
                    )}

                    <div className="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-xl border-t p-4 max-w-md mx-auto grid grid-cols-3">
                        <button onClick={() => setView('workout')} className={`flex flex-col items-center gap-1 ${view === 'workout' ? 'text-red-600' : 'text-slate-400'}`}><Icons.Calendar /> <span className="text-[10px] font-black uppercase">Log</span></button>
                        <button onClick={saveSession} className="bg-red-600 text-white p-4 rounded-2xl shadow-lg -mt-8 flex justify-center active:scale-95 transition-transform"><Icons.Save /></button>
                        <button onClick={() => setView('stats')} className={`flex flex-col items-center gap-1 ${view === 'stats' ? 'text-red-600' : 'text-slate-400'}`}><Icons.BarChart3 /> <span className="text-[10px] font-black uppercase">Stats</span></button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
